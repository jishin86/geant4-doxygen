<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example GB06</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example GB06 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ExampleGB06_s1"></a>
Parallel geometries with generic biasing</h1>
<p>This example demonstrates the use of parallel geometries in generic biasing, on a classical shield problem, using geometry-based importance biasing.</p>
<h2><a class="anchor" id="ExampleGB06_sub_s1"></a>
Geometry and activation of navigation in parallel world:</h2>
<p>The geometry is made of two parts:</p><ul>
<li>the mass (standard) geometry, which is made of a single block of concrete ; this is implemented in GB06DetectorConstuction ;</li>
<li>a parallel geometry, in which a series of slices is defined, these slices being created using a replica volume ; this is implemeted in GB06ParallelGeometryForSlices, which derives from the base class <a class="el" href="../../d6/dfb/classG4VUserParallelWorld.html">G4VUserParallelWorld</a> .</li>
</ul>
<p>The navigation in the parallel geometry is activated for neutrons. This is done in the main program <a class="el" href="../../d7/dca/exampleGB06_8cc.html" title="Main program of the GB06 example.">exampleGB06.cc</a>. The activation is made using the facilities of the <a class="el" href="../../d9/d6d/classG4GenericBiasingPhysics.html">G4GenericBiasingPhysics</a> class, as:</p>
<pre class="fragment">biasingPhysics-&gt;AddParallelGeometry("neutron",
                                    "parallelWorldForSlices");
</pre><p>where the first name is for the particle type to be aware of the parallel word, the second argument is the name of the parallel world.</p>
<p>When checking the process list of neutrons (/particle/select neutron and then /particle/process dump ) a new process, &lsquo;biasingLimiter&rsquo;, is visible. This process handles the step limitation in the parallel geometry. This process can handle several parallel geometries, these being passed to the process as biasingPhysics-&gt;AddParallelGeometry("neutron", "parallelWorld1") , biasingPhysics-&gt;AddParallelGeometry("neutron", "parallelWorld2") , etc.</p>
<p>The geometry-based importance technique utilizes only splitting and killing, hence techniques which are "non-physics biasing" techniques, in the sense they don't modify the behavior of physics processes. For this reason, only a process making the interface between the tracking and the biaising is inserted in the physics list, the physics processes themselves being untouched, this is made as:</p>
<pre class="fragment">biasingPhysics-&gt;NonPhysicsBias("neutron");
</pre><p>Finally, the volume (ie the slice) importances are defined in a simple "importance map" that is created in the GB06ParallelGeometryForSlices class, this map associating a replica number to a volume importance. The map is hold by the biasing operator.</p>
<h2><a class="anchor" id="ExampleGB06_sub_s2"></a>
Biasing classes:</h2>
<p>As usual, with the generic biasing scheme, a biasing operator and a biasing operation are defined, these are, respectively the</p><ul>
<li><a class="el" href="../../d4/dff/classGB06BOptrSplitAndKillByImportance.html">GB06BOptrSplitAndKillByImportance</a> and</li>
<li><a class="el" href="../../da/d39/classGB06BOptnSplitAndKillByImportance.html">GB06BOptnSplitAndKillByImportance</a></li>
</ul>
<p>classes. The operator here only handles one particle type. In the StartRun() method, it configures the biasing operation <a class="el" href="../../da/d39/classGB06BOptnSplitAndKillByImportance.html">GB06BOptnSplitAndKillByImportance</a> passing it the information related to the parallel geometry, and passing it the importance map.</p>
<p>The biasing operation <a class="el" href="../../da/d39/classGB06BOptnSplitAndKillByImportance.html">GB06BOptnSplitAndKillByImportance</a> applies a classical importance-based geometry technique, with spliting / killing at the slice bondaries. Splitting is made if the track goes from a smaller importance to a volume of larger importance, and killing (Russian roulette) is applied in the other case.</p>
<p>The particularity of this biasing operation is its handling of the parallel geometry information. It has to get by itself geometry information that, in the case of information of the mass geometry, are provided in the <a class="el" href="../../df/d47/classG4StepPoint.html">G4StepPoint</a> objects (pre step point, post step point) of the <a class="el" href="../../d9/d7a/classG4Step.html">G4Step</a>. Here, in the DistanceToApplyOperation(...), which is called at the beginning of the step, it gets a "snapshot" of the geometry state keeping a G4TouchableHistoryHandle. Then in the GenerateBiasingFinalState, which is called at the end of the step, it gets the new geometry state, with an other G4TouchableHistoryHandle. For a step that ends on the boundary, this last touchable history will logically point to the next volume. In this case, the biasing is applied, and the importances are obtained from the replica numbers taken from the two touchable histories, and then from the importance map.</p>
<h2><a class="anchor" id="ExampleGB06_sub_s3"></a>
Output</h2>
<p>A simple sensitive detector is defined (<a class="el" href="../../db/d29/classGB06SD.html">GB06SD</a>) and is attached to a thin volume ("meas.logical") placed after the concrete shield. This sensitive detector simply prints the information (particle type, kinetic energy, etc, and weight) of particles leaving the shield.</p>
<h2><a class="anchor" id="ExampleGB06_sub_s4"></a>
Known problems</h2>
<p>In exampleGB06.in the neutron killer process, nKiller, is de-activated (process that kills neutrons after some time), for two reasons. First, killing neutrons in a shield problem is not desirable because neutrons may fly for long time before leaving the shield, and hence must be accounted for. Second, if nKiller is left active, an exception message about a spurious displacement by 1e-7mm will appear sometimes : this happens when a neutron is killed on a volume boundary, and the navigation "sees" a (tiny) displacement, that should not exist. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
