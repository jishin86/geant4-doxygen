<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Tips how to run an example in multi-threading mode</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tips how to run an example in multi-threading mode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Only migrated examples or user applications can be run in multi-threading (MT) mode. The instructions for migrating user applications can be found in Geant4 documentation guides and a short howto is available here:</p>
<p><a href="https://twiki.cern.ch/twiki/bin/view/Geant4/QuickMigrationGuideForGeant4V10">https://twiki.cern.ch/twiki/bin/view/Geant4/QuickMigrationGuideForGeant4V10</a></p>
<p>In this file, we give just useful tips for running already migrated examples (or user applications).</p>
<h1><a class="anchor" id="HowToRunMT_s1"></a>
Run example in multi-threading mode</h1>
<p>No special steps are needed to build an example in multi-threading (MT) mode. The examples which has been migrated to multi-threading will automatically run in MT when they are built against the Geant4 libraries built with MT mode activated, otherwise they will run in sequential mode. Not migrated examples will run in sequential mode even when built against Geant4 libraries built with MT mode activated.</p>
<p>The examples which support MT can be easily recognized by the following lines of code in main (): </p><pre class="fragment">#ifdef G4MULTITHREADED
  G4MTRunManager* runManager = new G4MTRunManager;
#else
  G4RunManager* runManager = new G4RunManager;
#endif
</pre><p> The compiler flag -DG4MULTITHREADED is automatically set when building applications using Geant4's CMake (via GEANT4_USE_FILE) and GNUmake systems, and is listed in the flags reported by the &ndash;cflags option of the geant4-config program.</p>
<h1><a class="anchor" id="HowToRunMT_s2"></a>
Set number of threads</h1>
<p>When the number of threads is not selected in the application, the default number (which is actually 2) will be used. Another number of threads can be set in several ways:</p>
<ul>
<li>in the code <pre class="fragment">#ifdef G4MULTITHREADED
  G4MTRunManager* runManager = new G4MTRunManager;
  runManager-&gt;SetNumberOfThreads(4);
#else
  ...
</pre></li>
<li>in a macro file via UI command added just before /run/initialize <pre class="fragment">/run/numberOfThreads 4
</pre></li>
<li>by setting the environment variable <pre class="fragment">export G4FORCENUMBEROFTHREADS = 4  
or
setenv G4FORCENUMBEROFTHREADS 4
</pre></li>
</ul>
<p>The environment variable value is forced and it cannot be changed from a code call or a macro. A warning is issued in such situation.</p>
<h1><a class="anchor" id="HowToRunMT_s3"></a>
Output from threads</h1>
<p>In MT processing each worker produces its output and these messages are interlayed on the screen. The messeges from threads are preceded with a predefined string G4WTi&gt; where i is the thread number. Users can change this default behaviour and choose</p>
<ul>
<li>to buffer the output from each thread at a time, so that the output of each thread is grouped and printed at the end of the job <pre class="fragment">/control/cout/useBuffer true|false
</pre></li>
<li>to limit the output from threads to one selected thread only: <pre class="fragment">/control/cout/ignoreThreadsExcept 0
</pre></li>
<li>to redirect the output from threads in a file: <pre class="fragment">/control/cout/setCoutFile coutFileName
/control/cout/setCerrFile cerrFileName
</pre> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
