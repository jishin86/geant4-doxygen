<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example B5</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example B5 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Example B5 implements a double-arm spectrometer with wire chambers, hodoscopes and calorimeters. Event simulation and collection are enabled, as well as event display and analysis.</p>
<h1><a class="anchor" id="B5_s1"></a>
GEOMETRY</h1>
<p>The spectrometer consists of two detector arms (see <a class="el" href="../../d7/d68/classB5DetectorConstruction.html" title="Detector construction.">B5DetectorConstruction</a>). One arm provides position and timing information of the incident particle while the other collects position, timing and energy information of the particle after it has been deflected by a magnetic field centered at the spectrometer pivot point.</p>
<ul>
<li>First arm: box filled with air, also containing:<ul>
<li>1 hodoscope (15 vertical strips of plastic scintillator)</li>
<li>1 drift chamber (5 horizontal argon gas layers with a "virtual wire" at the center of each layer)</li>
</ul>
</li>
<li>Second arm: box filled with air, also containing:<ul>
<li>1 hodoscope (25 vertical strips of plastic scintillator)</li>
<li>1 drift chamber (5 horizontal argon gas layers with a "virtual wire" at the center of each layer)</li>
<li>1 electromagnetic calorimeter: a box sub-divided along x,y and z axes into cells of CsI</li>
<li>1 hadronic calorimeter: a box sub-divided along x,y, and z axes into cells of lead, with a layer of plastic scintillator placed at the center of each cell</li>
</ul>
</li>
<li>Magnetic field region: air-filled cylinder which contains the field (see <a class="el" href="../../d8/d0c/classB5MagneticField.html" title="Magnetic field.">B5MagneticField</a>)</li>
</ul>
<p>The maximum step limit in the magnetic field region is also set via the <a class="el" href="../../d9/d11/classG4UserLimits.html">G4UserLimits</a> class in a similar way as in Example B2 (see <a class="el" href="../../da/d82/ExampleB2.html#B2_s6">USER LIMITS</a> in B2 example documentation).</p>
<p>The rotation angle of the second arm and the magnetic field value can be set via the interactive commands defined using the <a class="el" href="../../d1/d92/classG4GenericMessenger.html" title="This class is generic messenger.">G4GenericMessenger</a> class. <br  />
</p>
<h1><a class="anchor" id="B5_s2"></a>
PHYSICS</h1>
<p>This example uses the reference hadronic physics list, FTFP_BERT, and also adds the <a class="el" href="../../d2/d9f/classG4StepLimiter.html">G4StepLimiter</a> process.</p>
<h1><a class="anchor" id="B5_s3"></a>
ACTION INITALIZATION</h1>
<p><a class="el" href="../../de/dfe/classB5ActionInitialization.html" title="Action initialization class.">B5ActionInitialization</a> class instantiates and registers to Geant4 kernel all user action classes.</p>
<p>While in sequential mode the action classes are instatiated just once, via invoking the method: <a class="el" href="../../de/dfe/classB5ActionInitialization.html#a8cb09d12af99f3d77823299688ecb95d">B5ActionInitialization::Build()</a> in multi-threading mode the same method is invoked for each thread worker and so all user action classes are defined thread-local.</p>
<p>A run action class is instantiated both thread-local and global that's why its instance is created also in the method <a class="el" href="../../de/dfe/classB5ActionInitialization.html#aaabfa63fb58bf084d299986df56b0ecc">B5ActionInitialization::BuildForMaster()</a> which is invoked only in multi-threading mode.</p>
<h1><a class="anchor" id="B5_s4"></a>
PRIMARY GENERATOR</h1>
<p>The primary generator action class employs the <a class="el" href="../../dc/ded/classG4ParticleGun.html">G4ParticleGun</a>. The primary kinematics consists of a single particle which is is sent in the direction of the first spectrometer arm.</p>
<p>The type of the particle and its several properties can be changed via the G4 built-in commands of the <a class="el" href="../../dc/ded/classG4ParticleGun.html">G4ParticleGun</a> class or this example command defined using the <a class="el" href="../../d1/d92/classG4GenericMessenger.html" title="This class is generic messenger.">G4GenericMessenger</a> class.</p>
<h1><a class="anchor" id="B5_s5"></a>
EVENT</h1>
<p>An event consists of the generation of a single particle which is transported through the first spectrometer arm. Here, a scintillator hodoscope records the reference time of the particle before it passes through a drift chamber where the particle position is measured. Momentum analysis is performed as the particle passes through a magnetic field at the spectrometer pivot and then into the second spectrometer arm. In the second arm, the particle passes through another hodoscope and drift chamber before interacting in the electromagnetic calorimeter. Here it is likely that particles will induce electromagnetic showers. <br  />
 The shower energy is recorded in a three-dimensional array of CsI crystals. Secondary particles from the shower, as well as primary particles which do not interact in the CsI crystals, pass into the hadronic calorimeter. Here, the remaining energy is collected in a three-dimensional array of scintillator-lead sandwiches.</p>
<p>Several aspects of the event may be changed interactively by the user:</p><ul>
<li>angle of the second spectrometer arm</li>
<li>strength of magnetic field</li>
<li>initial particle type</li>
<li>initial momentum and angle</li>
<li>momentum and angle spreads</li>
<li>type of initial particle may be randomized</li>
</ul>
<p>The initial particle type can be changed using the <a class="el" href="../../dc/ded/classG4ParticleGun.html">G4ParticleGun</a> command: </p><pre class="fragment">/gun/particle particleName
</pre><p>The UI commands specific to this example are available in /B5 command directory: </p><pre class="fragment">/B5/detector/armAngle angle unit
/B5/field/value field unit
/B5/generator/momentum  value unit
/B5/generator/sigmaMomentum value unit
/B5/generator/sigmaAngle value unit
/B5/generator/randomizePrimary [true|false]
</pre><p>They are implemented in</p><ul>
<li><a class="el" href="../../d7/d68/classB5DetectorConstruction.html#a7a1c3c589a7eb98102172ba6d6c6027a">B5DetectorConstruction::DefineCommands()</a>,</li>
<li><a class="el" href="../../d8/d0c/classB5MagneticField.html#afd13b62c4eeb31c0568286aada43207c">B5MagneticField::DefineCommands()</a> and</li>
<li><a class="el" href="../../d3/d94/classB5PrimaryGeneratorAction.html#a3e104c8dfff0b76cecc76ceff13eae70">B5PrimaryGeneratorAction::DefineCommands()</a> methods using <a class="el" href="../../d1/d92/classG4GenericMessenger.html" title="This class is generic messenger.">G4GenericMessenger</a> class.</li>
</ul>
<p>In first execution of <a class="el" href="../../d8/dd0/classB5EventAction.html#af433e1340ef102189797947a11f88c37">B5EventAction::BeginOfEventAction()</a> the hits collections identifiers are saved in data members of the class and used in <a class="el" href="../../d8/dd0/classB5EventAction.html#a8d0c10df7375ab9806c9900e77e496f3">B5EventAction::EndOfEventAction()</a> for accessing the hists collections and filling the accounted information in defined histograms and ntuples and printing its summary in a log file. The frequency of printing can be tuned with the built-in command </p><pre class="fragment">/run/printProgress  frequency
</pre><h1><a class="anchor" id="B5_s6"></a>
DETECTOR RESPONSE</h1>
<p>All the information required to simulate and analyze an event is recorded in hits. This information is recorded in the following sensitive detectors:</p>
<ul>
<li>hodoscope:<ul>
<li>particle time</li>
<li>strip ID, position and rotation<ul>
<li>see <a class="el" href="../../d3/d26/classB5HodoscopeSD.html" title="Hodoscope sensitive detector.">B5HodoscopeSD</a>, <a class="el" href="../../d9/de8/classB5HodoscopeHit.html" title="Hodoscope hit.">B5HodoscopeHit</a></li>
</ul>
</li>
</ul>
</li>
<li>drift chamber:<ul>
<li>particle time</li>
<li>particle position</li>
<li>layer ID<ul>
<li>see <a class="el" href="../../da/d9b/classB5DriftChamberSD.html" title="Drift chamber sensitive detector.">B5DriftChamberSD</a>, <a class="el" href="../../d3/d58/classB5DriftChamberHit.html" title="Drift chamber hit.">B5DriftChamberHit</a> classes</li>
</ul>
</li>
</ul>
</li>
<li>electromagnetic calorimeter:<ul>
<li>energy deposited in cell</li>
<li>cell ID, position and rotation<ul>
<li>see <a class="el" href="../../d8/d60/classB5EmCalorimeterSD.html" title="EM calorimeter sensitive detector.">B5EmCalorimeterSD</a>, <a class="el" href="../../d6/d68/classB5EmCalorimeterHit.html" title="EM Calorimeter hit.">B5EmCalorimeterHit</a> classes</li>
</ul>
</li>
</ul>
</li>
<li><p class="startli">hadronic calorimeter: <br  />
</p><ul>
<li>energy deposited in cell</li>
<li>cell column ID and row ID, position and rotation<ul>
<li>see <a class="el" href="../../d3/dcd/classB5HadCalorimeterSD.html" title="Hadron calorimeter sensitive detector.">B5HadCalorimeterSD</a>, <a class="el" href="../../d4/da4/classB5HadCalorimeterHit.html" title="Hadron Calorimeter hit.">B5HadCalorimeterHit</a> classes</li>
</ul>
</li>
</ul>
<p class="startli">The hit classes include methods GetAttDefs and CreateAttValues to define and then fill extra "HepRep-style" Attributes that the visualization system can use to present extra information about the hits. For example, if you pick a <a class="el" href="../../d4/da4/classB5HadCalorimeterHit.html" title="Hadron Calorimeter hit.">B5HadCalorimeterHit</a> in OpenGL or a HepRep viewer, you will be shown the hit's "Hit Type", "Column ID", "Row ID", "Energy Deposited" and "Position". These attributes are essentially arbitrary extra pieces of information (integers, doubles or strings) that are carried through the visualization. <br  />
 Each attribute is defined once in <a class="el" href="../../d3/d75/classG4AttDef.html">G4AttDef</a> object and then is filled for each hit in a <a class="el" href="../../d0/da4/classG4AttValue.html">G4AttValue</a> object. These attributes can also be used by commands to filter which hits are drawn: /vis/filtering/hits/drawByAttribute Detector Geometry and trajectories also carry HepRep-style attributes, but these are filled automatically in the base classes. HepRep is further described at the <a href="http://www.slac.stanford.edu/~perl/heprep/">HepRep Home Page </a></p>
</li>
</ul>
<h1><a class="anchor" id="B5_s7"></a>
ANALYSIS</h1>
<p>The analysis tools are used to accumulate statistics. Histograms and an ntuple are created in <a class="el" href="../../d1/d7a/classB5RunAction.html#a0e8630b79400276aa073fe370a0e2df7">B5RunAction::B5RunAction()</a> constructor for the following quantities:</p>
<ul>
<li>1D histograms:<ul>
<li>Number of hits in Chamber 1</li>
<li>Number of hits in Chamber 2</li>
</ul>
</li>
<li>2D histograms:<ul>
<li>Drift Chamber 1 X vs Y positions</li>
<li>Drift Chamber 2 X vs Y positions</li>
</ul>
</li>
<li>Ntuple:<ul>
<li>Number of hits in Chamber 1</li>
<li>Number of hits in Chamber 2</li>
<li>Total energy deposit in EM calorimeter</li>
<li>Total energy deposit in Hadronic calorimeter</li>
<li>Time of flight in Hodoscope 1</li>
<li>Time of flight in Hodoscope 2</li>
<li>Vector of energy deposits in EM calorimeter cells</li>
<li>Vector of energy deposits in Hadronic calorimeter cells</li>
</ul>
</li>
</ul>
<p>The histograms and ntuple are saved in the output file in a format according to a technology selected in <a class="el" href="../../d9/d3b/B5Analysis_8hh.html" title="Selection of the analysis technology.">B5Analysis.hh</a>.</p>
<p>When running in multi-threading mode, the histograms and ntuple accumulated on threads are automatically merged in a single output file.</p>
<h1><a class="anchor" id="B5_s8"></a>
BUILD OPTIONS</h1>
<p>This example can be built with excluding use of visualization and/or Geant4 user interface using G4VIS_USE and G4UI_USE compiler options (see <a class="el" href="../../d0/dba/exampleB5_8cc.html" title="Main program of the analysis/B5 example.">exampleB5.cc</a>). These options are defined by default with Geant4 configuration; they can be switched off at compilation time via the CMake options G4VIS_NONE or G4UI_NONE or via the environment variables of the same name if using GNUmake build.</p>
<hr  />
<p>The following paragraphs are common to all basic examples</p>
<h1><a class="anchor" id="B5_A"></a>
VISUALISATION</h1>
<p>The visualization manager is set via the <a class="el" href="../../df/d51/classG4VisExecutive.html">G4VisExecutive</a> class in the main () function in <a class="el" href="../../d0/dba/exampleB5_8cc.html" title="Main program of the analysis/B5 example.">exampleB5.cc</a>. <br  />
 The initialisation of the drawing is done via a set of /vis/ commands in the macro vis.mac. This macro is automatically read from the main function when the example is used in interactive running mode.</p>
<p>By default, vis.mac opens an OpenGL viewer (/vis/open OGL). The user can change the initial viewer by commenting out this line and instead uncommenting one of the other /vis/open statements, such as HepRepFile or DAWNFILE (which produce files that can be viewed with the HepRApp and DAWN viewers, respectively). Note that one can always open new viewers at any time from the command line. For example, if you already have a view in, say, an OpenGL window with a name "viewer-0", then </p><pre class="fragment">/vis/open DAWNFILE
</pre><p> then to get the same view </p><pre class="fragment">/vis/viewer/copyView viewer-0
</pre><p> or to get the same view <em>plus</em> scene-modifications </p><pre class="fragment">/vis/viewer/set/all viewer-0
</pre><p> then to see the result </p><pre class="fragment">/vis/viewer/flush
</pre><p>The DAWNFILE, HepRepFile drivers are always available (since they require no external libraries), but the OGL driver requires that the Geant4 libraries have been built with the OpenGL option.</p>
<p>vis.mac has additional commands that demonstrate additional functionality of the vis system, such as displaying text, axes, scales, date, logo and shows how to change viewpoint and style. To see even more commands use help or ls or browse the available UI commands in the Application Developers Guide.</p>
<p>For more information on visualization, including information on how to install and run DAWN, OpenGL and HepRApp, see the visualization tutorials, for example,<br  />
</p><ul>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4OpenGLTutorial/G4OpenGLTutorial.html">OpenGL Tutorial </a></li>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4DAWNTutorial/G4DAWNTutorial.html">DAWN Tutorial </a></li>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4HepRAppTutorial/G4HepRAppTutorial.html">HepRApp Tutorial </a></li>
</ul>
<p>The tracks are automatically drawn at the end of each event, accumulated for all events and erased at the beginning of the next run.</p>
<h1><a class="anchor" id="B5_B"></a>
USER INTERFACES</h1>
<p>This example can be built with excluding visualization and/or Geant4 user interface via G4VIS_USE and G4UI_USE compiler options (see <a class="el" href="../../d0/dba/exampleB5_8cc.html" title="Main program of the analysis/B5 example.">exampleB5.cc</a>). These options are defined by default with Geant4 configuration; they can switched off at compilation time via the CMake options G4VIS_NONE or G4UI_NONE or via the environment variables of the same name if using GNUmake build.</p>
<h1><a class="anchor" id="B5_C"></a>
HOW TO RUN</h1>
<ul>
<li>Execute exampleB5 in the 'interactive mode' with visualization <pre class="fragment">% exampleB5
and type in the commands from run1.mac line by line:
Idle&gt; /control/verbose 2
Idle&gt; /tracking/verbose 1
Idle&gt; /run/beamOn 10 
Idle&gt; ...
Idle&gt; exit
</pre> or <pre class="fragment">Idle&gt; /control/execute run1.mac
....
Idle&gt; exit
</pre></li>
<li>Execute exampleB5 in the 'batch' mode from macro files (without visualization) <pre class="fragment">% exampleB5 run2.mac
% exampleB5 exampleB5.in &gt; exampleB5.out
</pre> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
