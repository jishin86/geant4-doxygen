<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example B4</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example B4 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example simulates a simple Sampling Calorimeter setup. To demonstrate several possible ways of data scoring, the example is provided in four variants: B4a, B4b, B4c, B4d. (See also examples/extended/electromagnetic/TestEm3)</p>
<h1><a class="anchor" id="B4_s1"></a>
GEOMETRY DEFINITION</h1>
<p>The geometry is constructed in <a class="el" href="../../d0/d38/classB4DetectorConstruction.html" title="Detector construction class to define materials and geometry.">B4DetectorConstruction</a> class (see also <br  />
 <a class="el" href="../../df/dd3/classB4cDetectorConstruction.html">B4c </a>, <a class="el" href="../../da/d18/classB4dDetectorConstruction.html">B4d </a> variants). The calorimeter is a box made of a given number of layers. A layer consists of an absorber plate and of a detection gap. The layer is replicated.</p>
<p>Four parameters define the geometry of the calorimeter :</p><ul>
<li>the thickness of an absorber plate,</li>
<li>the thickness of a gap,</li>
<li>the number of layers, and</li>
<li>the transverse size of the calorimeter (the entrance face is a square).</li>
</ul>
<p>In addition, a global, uniform, and transverse magnetic field can be applied using <a class="el" href="../../d9/d64/classG4GlobalMagFieldMessenger.html">G4GlobalMagFieldMessenger</a>, instantiated in <a class="el" href="../../d0/d38/classB4DetectorConstruction.html#aa67122085804a2e3451b4f8a96c7c36c">B4DetectorConstruction::ConstructSDandField()</a> (see also <br  />
 <a class="el" href="../../df/dd3/classB4cDetectorConstruction.html#adf53fe0fb762376be3bf8512d1208cac">B4c </a>, <a class="el" href="../../da/d18/classB4dDetectorConstruction.html#a6efd7959c55e49d5780912e0a0b28a52">B4d </a> variants) with a non zero field value, or via interactive commands. For example:</p>
<pre class="fragment">/globalField/setValue 0.2 0 0 tesla
</pre><pre>
        |&lt;----layer 0----------&gt;|&lt;----layer 1----------&gt;|&lt;----layer 2----------&gt;|
        |                       |                       |                       |
        ==========================================================================
        ||              |       ||              |       ||              |       ||
        ||              |       ||              |       ||              |       ||
 beam   ||   absorber   |  gap  ||   absorber   |  gap  ||   absorber   |  gap  ||
======&gt; ||              |       ||              |       ||              |       ||
        ||              |       ||              |       ||              |       ||
        ==========================================================================</pre><pre></pre><p>A more general version of this geometry can be found in: examples/extended/electromagnetic/TestEm3 <br  />
 where all the geometry parameters, the absorber and gap materials can be modified interactively via the commands defined in the <a class="el" href="../../d6/d1f/classDetectorMessenger.html" title="Messenger class that defines commands for DetectorConstruction.">DetectorMessenger</a> class.</p>
<h1><a class="anchor" id="B4_s2"></a>
PHYSICS LIST</h1>
<p>The particle's type and the physic processes which will be available in this example are set in the FTFP_BERT physics list. This physics list requires data files for electromagnetic and hadronic processes. See more on installation of the datasets in <a href="http://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/InstallationGuide/html/ch03s03.html">Geant4 Installation Guide, Chapter 3.3: Note On Geant4 Datasets </a>. The following datasets: G4LEDATA, G4LEVELGAMMADATA, G4SAIDXSDATA and G4ENSDFSTATEDATA are mandatory for this example.</p>
<p>In addition the build-in interactive command: </p><pre class="fragment">/process/(in)activate processName
</pre><p> allows to activate/inactivate the processes one by one.</p>
<h1><a class="anchor" id="B4_s3"></a>
ACTION INITALIZATION</h1>
<p>A newly introduced class, <a class="el" href="../../dd/d28/classB4aActionInitialization.html" title="Action initialization class.">B4aActionInitialization</a>, (see also <a class="el" href="../../df/d54/classB4bActionInitialization.html">B4b </a>, <a class="el" href="../../d8/dfa/classB4cActionInitialization.html">B4c </a>, <a class="el" href="../../d1/df4/classB4dActionInitialization.html">B4d </a> variants), instantiates and registers to Geant4 kernel all user action classes;</p>
<p>While in sequential mode the action classes are instatiated just once, via invoking the method: <a class="el" href="../../dd/d28/classB4aActionInitialization.html#a77ce9dc663c22e6c7d8c87d321507011">B4aActionInitialization::Build()</a> (see also <a class="el" href="../../df/d54/classB4bActionInitialization.html#af7cc6b80f91407cb02d41d63028f19d2">B4b </a>, <a class="el" href="../../d8/dfa/classB4cActionInitialization.html#a78a72b90dde06e8c1b3bd40c6fc36ed4">B4c </a>, <a class="el" href="../../d1/df4/classB4dActionInitialization.html#a3b48ce82bcc1ca8d47bca56b95c1bc6a">B4d </a> variants), in multi-threading mode the same method is invoked for each thread worker and so all user action classes are defined thread-local.</p>
<p>A run action class is instantiated both thread-local and global that's why its instance is created also in the method <a class="el" href="../../dd/d28/classB4aActionInitialization.html#ada9e01fc8d81eb82d4fded2578b3d4eb">B4aActionInitialization::BuildForMaster()</a> (see also <a class="el" href="../../df/d54/classB4bActionInitialization.html#adf4229c28f64a0e820b3c44318c4f8d2">B4b </a>, <a class="el" href="../../d8/dfa/classB4cActionInitialization.html#ab5c72e99e0abbda5dd7e7988c0749318">B4c </a>, <a class="el" href="../../d1/df4/classB4dActionInitialization.html#a76ad0188850dc96bc99e41a9c7b3a6ea">B4d </a> variants), which is invoked only in multi-threading mode.</p>
<h1><a class="anchor" id="B4_s4"></a>
PRIMARY GENERATOR</h1>
<p>The primary beam consists of a single particle which hits the calorimeter perpendicular to the input face. The type of the particle and its energy are set in the <a class="el" href="../../d1/ded/classB4PrimaryGeneratorAction.html" title="The primary generator action class with particle gum.">B4PrimaryGeneratorAction</a> class, and can be changed via the G4 built-in commands of the <a class="el" href="../../dc/ded/classG4ParticleGun.html">G4ParticleGun</a> class (see the macros provided with this example).</p>
<h1><a class="anchor" id="B4_s5"></a>
RUNS and EVENTS</h1>
<p>A run is a set of events.</p>
<p>The user can choose the frequency of printing via the Geant4 interactive command, for example: </p><pre class="fragment">/run/printProgress 100
</pre><h1><a class="anchor" id="B4_s6-"></a>
DETECTOR RESPONSE</h1>
<p>The energy deposit and track lengths of the charged particles are recorded on an event by event basis in the Absober and Gap layers.</p>
<p>In order to demonstrate several possible ways of data scoring, the example is provided in four variants:</p>
<h2><a class="anchor" id="s6a"></a>
Variant a: User Actions</h2>
<p>These 4 quantities are data members of the <a class="el" href="../../d4/d6d/classB4aEventAction.html" title="Event action class.">B4aEventAction</a> class. <br  />
 They are collected step by step in <a class="el" href="../../df/dd2/classB4aSteppingAction.html#a3d9938b975023565a0a0f2f8be44f193">B4aSteppingAction::UserSteppingAction()</a>, and passed to the event action via two methods: <a class="el" href="../../d4/d6d/classB4aEventAction.html#a37b37e551f83805ea14b2c6915450be7">B4aEventAction::AddAbs()</a> and <a class="el" href="../../d4/d6d/classB4aEventAction.html#acad832617bc013e15e00ccb207102315">B4aEventAction::AddGap()</a>.</p>
<p>In <a class="el" href="../../d4/d6d/classB4aEventAction.html#a5959353e1b80f18dc6e480892e34c39f">B4aEventAction::EndOfEventAction()</a>, these quantities are printed and filled in H1D histograms and ntuple to accumulate statistic and compute dispersion.</p>
<h2><a class="anchor" id="s6b"></a>
Variant b: User data object</h2>
<p>In order to avoid dependencies between action classes, a user object <a class="el" href="../../d9/dd6/classB4bRunData.html" title="Run data class.">B4bRunData</a>, derived from <a class="el" href="../../d2/d10/classG4Run.html">G4Run</a>, is defined with data members needed for the accounted information. In order to reduce the number of data members a 2-dimensions array is introduced for each quantity. Then the quantities are collected step by step in user action classes: <a class="el" href="../../d7/d47/classB4bSteppingAction.html#a4f2cda2313a3d7cbcbac97bf29e2fac3">B4bSteppingAction::UserSteppingAction()</a> and <a class="el" href="../../df/d03/classB4bEventAction.html#a63c25c94eeda595ee893826b40e9bfd9">B4bEventAction::EndOfEventAction()</a> in a similar way as in variant a.</p>
<h2><a class="anchor" id="s6c"></a>
Variant c: Hits and Sensitive detectors</h2>
<p>In this option, the physics quantities are accounted using the hits and sensitive detectors framework defined in the Geant4 kernel. <br  />
 The physics quantities are stored in <a class="el" href="../../dc/d94/classB4cCalorHit.html" title="Calorimeter hit class.">B4cCalorHit</a> via two <a class="el" href="../../d1/daa/classB4cCalorimeterSD.html" title="Calorimeter sensitive detector class.">B4cCalorimeterSD</a> objects, one associated with the Absorber volume and another one with Gap in <a class="el" href="../../df/dd3/classB4cDetectorConstruction.html#adf53fe0fb762376be3bf8512d1208cac">B4cDetectorConstruction::ConstructSDandField()</a>.</p>
<p>In contrary to the B2 example (Tracker) where a new hit is created with each track passing the sensitive volume (in the calorimeter), only one hit is created for each calorimeter layer and one more hit to account for the total quantities in all layers. In addition to the variants a and b, the quantities per each layer are also available in addition to the total quantities.</p>
<h2><a class="anchor" id="s6d"></a>
Variant d: Scorer</h2>
<p>In this option, the Geant4 scorers which are defined on the top of hits and sensitive detectors Geant4 framework are used. <br  />
 In practice this means that the user does not need to define hits and sensitive detector classes but rather uses the classes already defined in Geant4. In this example, the <a class="el" href="../../da/d7e/classG4MultiFunctionalDetector.html">G4MultiFunctionalDetector</a> with <a class="el" href="../../de/d64/classG4PSEnergyDeposit.html">G4PSEnergyDeposit</a> and <a class="el" href="../../df/d85/classG4PSTrackLength.html">G4PSTrackLength</a> primitive scores are used (see <a class="el" href="../../da/d18/classB4dDetectorConstruction.html#a6efd7959c55e49d5780912e0a0b28a52">B4dDetectorConstruction::ConstructSDandField()</a>).</p>
<p>Also with this approach, the quantities per each layer are available in addition to the total quantities.</p>
<h1><a class="anchor" id="B4_s7"></a>
HISTOGRAMS</h1>
<p>The analysis tools are used to accumulate statistics and compute the dispersion of the energy deposit and track lengths of the charged particles. H1D histograms are created in <a class="el" href="../../d0/d61/classB4RunAction.html#abba3e4f151404ac93a4ec52291959cc5">B4RunAction::B4RunAction()</a> (see also <a class="el" href="../../dc/d93/classB4bRunAction.html#a0de753ed440ccc3cb14d85c429025d1e">B4b </a> variant) for the following quantities:</p><ul>
<li>Energy deposit in absorber</li>
<li>Energy deposit in gap</li>
<li><a class="el" href="../../d9/d18/classTrack.html">Track</a> length in absorber</li>
<li><a class="el" href="../../d9/d18/classTrack.html">Track</a> length in gap</li>
</ul>
<p>The same values are also saved in an ntuple.</p>
<p>The histograms and the ntuple are saved in the output file in a format according to a technology selected in B4Analysis.hh, the default in this example is ROOT.</p>
<p>The accumulated statistic and computed dispersion is printed at the end of run, in <a class="el" href="../../d0/d61/classB4RunAction.html#a434d1176defb9237b52dbf6a73c63678">B4RunAction::EndOfRunAction()</a> ((see also <a class="el" href="../../dc/d93/classB4bRunAction.html#a7fe35112a9a8de0c4ecf1f007b291b0e">B4b </a> variant). When running in multi-threading mode, the histograms and the ntuple accumulated on threads are merged in a single output file. While merging of histograms is performed by default, merging of ntuples is explicitly activated in the <a class="el" href="../../d0/d61/classB4RunAction.html" title="Run action class.">B4RunAction</a> constructor.</p>
<p>The ROOT histograms and ntuple can be plotted with ROOT using the plotHisto.C and plotNtuple.C macros.</p>
<h1><a class="anchor" id="B4_s8"></a>
VISUALIZATION TUTORIAL</h1>
<p>Additional visualization tutorial macros are available in the visTutor subdirectory. They can be tried as: </p><pre class="fragment">% cd B4/B4[a,b,c,d]
% ln -s ../macros/visTutor visTutor
% exampleB4[a,b,c,d]
Idle &gt; /control/execute visTutor/exN03VisX.mac
</pre><p> For details, see comment lines described in the macro files. These macros are designed to help your understanding of the User's Guide.</p>
<h1><a class="anchor" id="B4_s9"></a>
HOW TO RUN</h1>
<p>This example handles the program arguments in a new way. It can be run with the following optional arguments: </p><pre class="fragment">% exampleB4a [-m macro ] [-u UIsession] [-t nThreads]
</pre><p>The -t option is available only in multi-threading mode and it allows the user to override the Geant4 default number of threads. The number of threads can be also set via G4FORCENUMBEROFTHREADS environment variable which has the top priority.</p>
<ul>
<li>Execute exampleB4a in the 'interactive mode' with visualization <pre class="fragment">% exampleB4a
and type in the commands from run1.mac line by line:  
Idle&gt; /tracking/verbose 1 
Idle&gt; /run/beamOn 1
Idle&gt; ...
Idle&gt; exit
</pre> or <pre class="fragment">Idle&gt; /control/execute run1.mac
....
Idle&gt; exit
</pre></li>
<li>Execute exampleB4a in the 'batch' mode from macro files (without visualization) <pre class="fragment">% exampleB4a -m run2.mac
% exampleB4a -m exampleB4.in &gt; exampleB4.out
</pre></li>
<li>Execute exampleB4a in the 'interactive mode' with a selected UI session, e.g. tcsh <pre class="fragment">% exampleB4a -u tcsh 
</pre></li>
</ul>
<hr  />
<p>The following paragraphs are common to all basic examples</p>
<h1><a class="anchor" id="B4_A"></a>
VISUALISATION</h1>
<p>The visualization manager is set via the <a class="el" href="../../df/d51/classG4VisExecutive.html">G4VisExecutive</a> class in the main () function in <a class="el" href="../../d7/df4/exampleB4a_8cc.html" title="Main program of the B4a example.">exampleB4a.cc</a>. <br  />
 The initialisation of the drawing is done via a set of /vis/ commands in the macro vis.mac. This macro is automatically read from the main function when the example is used in interactive running mode.</p>
<p>By default, vis.mac opens an OpenGL viewer (/vis/open OGL). The user can change the initial viewer by commenting out this line and instead uncommenting one of the other /vis/open statements, such as HepRepFile or DAWNFILE (which produce files that can be viewed with the HepRApp and DAWN viewers, respectively). Note that one can always open new viewers at any time from the command line. For example, if you already have a view in, say, an OpenGL window with a name "viewer-0", then </p><pre class="fragment">/vis/open DAWNFILE
</pre><p> then to get the same view </p><pre class="fragment">/vis/viewer/copyView viewer-0
</pre><p> or to get the same view <em>plus</em> scene-modifications </p><pre class="fragment">/vis/viewer/set/all viewer-0
</pre><p> then to see the result </p><pre class="fragment">/vis/viewer/flush
</pre><p>The DAWNFILE, HepRepFile drivers are always available (since they require no external libraries), but the OGL driver requires that the Geant4 libraries have been built with the OpenGL option.</p>
<p>For more information on visualization, including information on how to install and run DAWN, OpenGL and HepRApp, see the visualization tutorials, for example,<br  />
</p><ul>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4OpenGLTutorial/G4OpenGLTutorial.html">OpenGL Tutorial </a></li>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4DAWNTutorial/G4DAWNTutorial.html">DAWN Tutorial </a></li>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4HepRAppTutorial/G4HepRAppTutorial.html">HepRApp Tutorial </a></li>
</ul>
<p>The tracks are automatically drawn at the end of each event, accumulated for all events and erased at the beginning of the next run.</p>
<h1><a class="anchor" id="B4_B"></a>
USER INTERFACES</h1>
<p>The user command interface is set via the <a class="el" href="../../d1/d6d/classG4UIExecutive.html">G4UIExecutive</a> class in the main () function in <a class="el" href="../../d7/df4/exampleB4a_8cc.html" title="Main program of the B4a example.">exampleB4a.cc</a> The selection of the user command interface is then done automatically according to the Geant4 configuration or it can be done explicitly via the third argument of the <a class="el" href="../../d1/d6d/classG4UIExecutive.html">G4UIExecutive</a> constructor (see <a class="el" href="../../d7/df4/exampleB4a_8cc.html" title="Main program of the B4a example.">exampleB4a.cc</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
