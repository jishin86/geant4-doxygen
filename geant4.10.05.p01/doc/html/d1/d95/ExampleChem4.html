<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example chem4</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example chem4 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>P. Piersimoni (a), M. Karamitros (b) <br  />
(a) pierluigi.piersimoni _ gmail _ com <br  />
(b) matkara _ gmail _ com <br  />
 This example is provided by the Geant4-DNA collaboration. (<a href="http://geant4-dna.org">http://geant4-dna.org</a>)</dd></dl>
<p>Any report or published results obtained using the Geant4-DNA software shall cite the following Geant4-DNA collaboration publications: <br  />
Phys. Med. 31 (2015) 861-874 <br  />
Med. Phys. 37 (2010) 4692-4708 <br  />
 The example shows how to activate the chemistry code and score the radiochemical yield G defined as <br  />
</p><pre class="fragment">(Number of species X) / (100 eV of deposited energy).
</pre><p> in a range of deposited energy [X;Y] chosen by the user.<br  />
 </p>
<h1><a class="anchor" id="CHEM4_s1"></a>
GEOMETRY DEFINITION</h1>
<p>The world volume is a simple box which represents a 'pseudo infinite' homogeneous medium.</p>
<p>Two parameters define the geometry :</p><ul>
<li>the material of the box &ndash; for Geant4-DNA it has to be water.</li>
<li>the full size of the box.</li>
</ul>
<p>The default geometry is constructed in <a class="el" href="../../dc/d5b/classDetectorConstruction.html" title="Simple detector construction with a box volume placed in a world.">DetectorConstruction</a> class.</p>
<h1><a class="anchor" id="CHEM4_s2"></a>
PHYSICS LIST</h1>
<p><a class="el" href="../../d2/daa/classPhysicsList.html">PhysicsList</a> is Geant4 modular physics list using <a class="el" href="../../da/df0/classG4EmDNAPhysics.html">G4EmDNAPhysics</a> &amp; <a class="el" href="../../d3/df8/classG4EmDNAChemistry.html">G4EmDNAChemistry</a> constructors. It will later be updated to use the G4EmDNAModelActivator constructor</p>
<h1><a class="anchor" id="CHEM4_s3"></a>
ACTION INITALIZATION</h1>
<p>The class <a class="el" href="../../de/dcd/classActionInitialization.html" title="Action initialization class.">ActionInitialization</a> instantiates and registers to Geant4 kernel all user action classes.</p>
<p>While in sequential mode the action classes are instantiated just once, via invoking the method <a class="el" href="../../de/dcd/classActionInitialization.html#a9b8f6328b1b2e3ba39a1c230774cab66">ActionInitialization::Build()</a> in multi-threading mode the same method is invoked for each thread worker and so all user action classes are defined thread-local.</p>
<p>A run action class is instantiated both thread-local and global that's why its instance is created also in the method <a class="el" href="../../de/dcd/classActionInitialization.html#a48c24b5a340ef3e8a69f44f9b6bf02be">ActionInitialization::BuildForMaster()</a> which is invoked only in multi-threading mode.</p>
<h1><a class="anchor" id="CHEM4_s4"></a>
AN EVENT: PRIMARY GENERATOR</h1>
<p>The primary kinematic consists of a single particle starting at the center of the box. The type of the particle and its energy are set in the <a class="el" href="../../d7/d27/classPrimaryGeneratorAction.html" title="The primary generator action class with particle gun.">PrimaryGeneratorAction</a> class, and can be changed via the G4 build-in commands of <a class="el" href="../../dc/ded/classG4ParticleGun.html">G4ParticleGun</a> class. The chemistry module is triggered in the <a class="el" href="../../d4/d47/classStackingAction.html" title="Stacking action class : manage the newly generated particles.">StackingAction</a> class when all physical tracks have been processed.</p>
<h1><a class="anchor" id="CHEM4_s5"></a>
DETECTOR RESPONSE : Scorers</h1>
<h2><a class="anchor" id="CHEM4_s5_sub1"></a>
Species scorer</h2>
<p>Scorers are defined in <a class="el" href="../../dc/d5b/classDetectorConstruction.html#aa88426683f97c31c8053004bd6952751">DetectorConstruction::ConstructSDandField()</a>. There is one <a class="el" href="../../da/d7e/classG4MultiFunctionalDetector.html">G4MultiFunctionalDetector</a> object which computes the energy deposition and the number of species along time in order to extract the radiochemical yields: </p><pre class="fragment">(Number of species X) / (100 eV of deposited energy).
</pre><p><a class="el" href="../../de/db2/classRun.html#a8476edf182546b547d1be728b477e379">Run::RecordEvent()</a>, called at end of event, collects informations event per event from the hits collections, and accumulates statistic for <a class="el" href="../../d7/df6/classRunAction.html#a49e3c5db63358317c3babca100163bd9">RunAction::EndOfRunAction()</a>.</p>
<p>In multi-threading mode the statistics accumulated per workers is merged to the master in <a class="el" href="../../de/db2/classRun.html#adf78ab86b4a2ba38a7b79df6dcc6bc27">Run::Merge()</a>.</p>
<p>The information about all the molecular species is scored in a ROOT ntuple file Species.root. The root macro program PlotNtuple.C can be used to plot the G values vs time, for each species.</p>
<h2><a class="anchor" id="CHEM4_s5_sub2"></a>
Primary Killer</h2>
<p>The G-values are computing for a range of deposited energy. We are in an infinite volume. Therefore the energy lost by the primary equals the deposited energy since all secondary particles will finally slow down to the thermal energy. The primary is killed once it has deposited more energy than a minimum threshold. IMPORTANT: However, when the primary particle looses more energy in few interaction steps than the maximum allowed thresold, the event is disregarded (=aborted). <br  />
 These two macro commands can be used to control the energy loss by the primary:</p>
<pre class="fragment">/primaryKiller/eLossMin 1 keV 
# after 1 keV of energy loss by the primary particle, the primary is killed

/primaryKiller/eLossMax 2 keV 
# if the primary particle losses more than 2 keV, the event is aborted
</pre><p>The G-values are then computed for a deposited energy in the range [1 keV;2 keV].</p>
<p>Note that if the upper boundary of the energy lost by the primary is not set, the chemistry may take a lot of time to compute as the number of secondaries may be huge. This set of macros is embedded in the <a class="el" href="../../d0/d9d/classPrimaryKiller.html">PrimaryKiller</a> class. The species scorer must check whether the event was aborted before taking it or not into account for the computation of the results.</p>
<h1><a class="anchor" id="CHEM4_s6"></a>
STACKING ACTION</h1>
<p><a class="el" href="../../d4/d47/classStackingAction.html#af9f38d1665274246654f501fe63adfa7">StackingAction::NewStage</a> is called when a stack of tracks has been processed (for more details, look at the Geant4 documentation). A verification on whether physical tracks remain to be processed is done. If no tracks remain to be processed, the chemical module is then triggered.</p>
<h1><a class="anchor" id="CHEM4_s7"></a>
VISUALISATION</h1>
<p>The visualization manager is set via the <a class="el" href="../../df/d51/classG4VisExecutive.html">G4VisExecutive</a> class in the <a class="el" href="../../d8/d8f/genwindef_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a> function in <a class="el" href="../../d1/dcb/chem4_8cc.html" title="Chem4 example.">chem4.cc</a>. The initialisation of the drawing is done via a set of /vis/ commands in the macro vis.mac. To activate the visualization mode run: </p><pre class="fragment">./chem4 -vis
</pre><h1><a class="anchor" id="CHEM4_s8"></a>
OUTPUT</h1>
<p>Physics initialization and the defined reaction table are printed. <a class="el" href="../../de/dcb/classG4Scheduler.html" title="G4Scheduler synchronizes (in time) track stepping.">G4Scheduler</a> processes the chemical stage time step after time step. Chemical reactions are printed. The molecular reaction as a function of the elapsed time can be displayed setting the macro command /scheduler/verbose 1</p>
<h1><a class="anchor" id="CHEM4_s9"></a>
RELEVANT MACRO COMMANDS</h1>
<pre class="fragment">/primaryKiller/eLoss 1 keV       # after 1 keV of energy loss by the primary particle, the primary is killed
/scheduler/verbose 1             # set the verbose level of the G4Scheduler class (time steps, reactions ...)
/scheduler/endTime 1 microsecond # set the time at which the simulation stops
/scheduler/whyDoYouStop          # for advanced users: print information at the end of the chemical stage 
                                 # to know why the simulation has stopped
</pre><h1><a class="anchor" id="CHEM4_s10"></a>
PLOT</h1>
<p>The information about all the molecular species is scored in a ROOT ntuple file Species.root during the run of chem4. The ROOT program plotG can be used to plot the G values vs time, for each species. It must be launched after chem4 has run. When "plotG" is executed, select the root file output by the chem4 application. You can also execute plotG as: </p><pre class="fragment">./plot/plotG Species.root 
</pre><p> where Species.root is the file output by the chem4 application.</p>
<h1><a class="anchor" id="CHEM4_s11"></a>
OTHER INFORMATION</h1>
<p>I have access to a track. How do I access to its molecular information? </p><pre class="fragment">#include "G4Molecule.hh"
G4Track* thisIsMytrack = ...
G4Molecule* thisIsMyMolecule = GetMolecule(thisIsMyTrack);
</pre><p> If the pointer thisIsMyMolecule is null, then this is NOT a chemical species</p>
<p>How do I get the molecule's name? </p><pre class="fragment">G4Molecule* thisIsMyMolecule = ...
const G4String&amp; moleculeName = thisIsMyMolecule-&gt;GetName();
</pre><p>How can I display the reaction information?</p><ul>
<li>Use this macro command: <pre class="fragment">/scheduler/verbose 1
</pre></li>
</ul>
<p>How can I display the step by step information?</p><ol type="1">
<li>Add ITTrackingInteraction to the <a class="el" href="../../de/dcb/classG4Scheduler.html" title="G4Scheduler synchronizes (in time) track stepping.">G4Scheduler</a> singleton (cf. chem3)</li>
<li>Use <br  />
 <pre class="fragment">/chem/tracking/verbose 1
</pre> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
