<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Category : parallel/MPI</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Category : parallel/MPI </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md12"></a>
About the interface</h1>
<p>G4MPI is a native interface with MPI libraries. The directory contains a Geant4 UI library and a couple of parallelized examples. Using this interface, users applications can be parallelized with different MPI compliant libraries, such as OpenMPI, MPICH2 and so on.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
System Requirements:</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
MPI Library</h3>
<p>The MPI interface can work with MPI-compliant libraries, such as Open MPI, MPICH, Intel MPI etc.</p>
<p>For example, the information about Open MPI can be obtained from <a href="http://www.open-mpi.org/">http://www.open-mpi.org/</a></p>
<h2><a class="anchor" id="autotoc_md15"></a>
MPI support:</h2>
<p><a class="el" href="../../d1/d66/namespaceG4mpi.html">G4mpi</a> has been tested with the following MPI flavors: OpenMPI 1.8.1 MPICH 3.2 Intel MPI 5.0.1</p>
<h3><a class="anchor" id="autotoc_md16"></a>
CMake</h3>
<p>CMake is used to build <a href="../.././group__extended__parallel__MPI__libG4mpi.html">G4MPI </a> library, that co-works with Geant4 build system.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
Optional (for exMPI02)</h3>
<p>ROOT for histogramming/analysis</p>
<h1><a class="anchor" id="autotoc_md18"></a>
How to build G4MPI</h1>
<p>To build G4MPI library, use CMake on Geant4 library installed with CMake build.</p>
<p>Follow these commands, </p><pre class="fragment">&gt; mkdir build
&gt; cd build
&gt; cmake -DGeant4_DIR=&lt;your Geant4 install path&gt;/lib[64]/Geant4-V.m.n \
 -DCMAKE_INSTALL_PREFIX=&lt;where-G4mpi-lib-will-be-installed&gt; \
 &lt;g4source&gt;/examples/extended/parallel/MPI/source
&gt; make
&gt; make install
</pre><p>The cmake step will try to guess where MPI is installed, mpi executables should be in PATH. You can specify CXX and CC environment variables to your specific mpi wrappers if needed.</p>
<p>The library and header files will be installed on the installation directory specified in CMAKE_INSTALL_PREFIX a CMake configuration file will also be installed (see examples on how to compile an application using <a class="el" href="../../d1/d66/namespaceG4mpi.html">G4mpi</a>)</p>
<h1><a class="anchor" id="autotoc_md19"></a>
How to use</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
How to make parallel applications</h2>
<p>An example of a main program:</p>
<pre class="fragment">#include "G4MPImanager.hh"
#include "G4MPIsession.hh"

int main(int argc,char** argv)
{
  // At first, G4MPImanager/G4MPIsession should be created.
  G4MPImanager* g4MPI= new G4MPImanager(argc,argv);
      
  // MPI session (G4MPIsession) instead of G4UIterminal
  G4MPIsession* session= g4MPI-&gt; GetMPIsession();
      
  // user application setting
  G4RunManager* runManager= new G4RunManager();

  ....

  // After user application setting, just start a MPI session.
  MPIsession treats both interactive and batch modes.
  session-&gt; SessionStart();

  // Finally, terminate the program
  delete g4MPI;
  delete runManager;
}    
```
</pre><h2><a class="anchor" id="autotoc_md21"></a>
How to compile</h2>
<p>Using cmake, assuming <a class="el" href="../../d1/d66/namespaceG4mpi.html">G4mpi</a> library is installed in path <em>g4mpi-path</em> and Geant4 is installed in <em>g4-path</em>: </p><pre class="fragment">&gt; mkdir build
&gt; cd build
&gt; cmake -DGeant4_DIR=&lt;g4-path&gt;/lib[64]/Geant4-V.m.n \
  -DG4mpi_DIR=&lt;g4mpi-path&gt;/lib[64]/G4mpi-V.m.n \
  &lt;source&gt;
&gt; make
</pre><p>Check provided examples: under examples/extended/parallel/MPI/examples for an example of CMakeLists.txt file to be used.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
Notes about session shell</h3>
<p>LAM/MPI users can use "G4tcsh" as an interactive session shell. For other users (Open MPI/MPICH2), plesae use G4csh (default).</p>
<p>In case of OpenMPI, <em>LD_LIBRARY_PATH</em> for OpenMPI runtime libraries should be set at run time. Alternatively, you can add this path to the dynamic linker configuration using <code>ldconfig</code>. (needs sys-admin authorization)</p>
<h2><a class="anchor" id="autotoc_md23"></a>
MPI runtime Environment</h2>
<ol type="1">
<li>Make hosts/cluster configuration of your MPI environment.</li>
<li>Launch MPI runtime environment, typically executing <code>lamboot</code> (LAM) / <code>mpdboot</code> (MPICH2) / <code>mpd</code> (Intel).</li>
</ol>
<h2><a class="anchor" id="autotoc_md24"></a>
How to run</h2>
<p>For example, </p><pre class="fragment">&gt; mpiexec -n # &lt;your application&gt;
</pre> <p>Replace mpicxx with your MPI compiler wrapper if you need to specify which one to use.</p>
<p>Instead, <code>mpirun</code> command is more convenient for LAM users.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
MPI G4UI commands</h2>
<p>G4UI commands handling the G4MPI interface are placed in /mpi/.</p>
<div class="fragment"><div class="line">Command directory path : /mpi/</div>
<div class="line">    </div>
<div class="line">Guidance :</div>
<div class="line">MPI control commands</div>
<div class="line">    </div>
<div class="line"> Sub-directories :</div>
<div class="line"> Commands :</div>
<div class="line">   verbose *        <a class="code" href="../../db/d75/namespaceG4ArrayOps.html#ade7cd1394fa7f61c3596efbdcd19c931">Set</a> verbose level.</div>
<div class="line">   status *         Show mpi status.</div>
<div class="line">   execute *        Execute <a class="code" href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a> macro file. (=/control/execute)</div>
<div class="line">   beamOn *         Start <a class="code" href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a> parallel run w/ thread.</div>
<div class="line">   .beamOn *        Start <a class="code" href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a> parallel run w/o thread.</div>
<div class="line">   masterWeight *   <a class="code" href="../../db/d75/namespaceG4ArrayOps.html#ade7cd1394fa7f61c3596efbdcd19c931">Set</a> weight <span class="keywordflow">for</span> master node.</div>
<div class="line">   showSeeds *      Show seeds of MPI nodes.</div>
<div class="line">   setMasterSeed *  <a class="code" href="../../db/d75/namespaceG4ArrayOps.html#ade7cd1394fa7f61c3596efbdcd19c931">Set</a> <a class="code" href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a> master <a class="code" href="../../d1/dcb/chem4_8cc.html#affb5f34f39f7103b999d198b18ffed8e">seed</a> <span class="keywordflow">for</span> the <a class="code" href="../../d1/dcb/chem4_8cc.html#affb5f34f39f7103b999d198b18ffed8e">seed</a> generator.</div>
<div class="line">   setSeed *        <a class="code" href="../../db/d75/namespaceG4ArrayOps.html#ade7cd1394fa7f61c3596efbdcd19c931">Set</a> <a class="code" href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a> <a class="code" href="../../d1/dcb/chem4_8cc.html#affb5f34f39f7103b999d198b18ffed8e">seed</a> <span class="keywordflow">for</span> <a class="code" href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a> specified node.</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md26"></a>
Notes:</h3>
<p>While "/run/beamOn" and "/mpi/beamOn" commands invoke beam-on in background, so you can input UI commands even while event processing. Note that drawing tracks in OpenGL with these commands causes a crash. Please use /mpi/.beamOn command instead.</p>
<p>The original "/control/execute" and "/run/beamOn" are overwritten with "/mpi/execute" and "/mpi/beamOn" commands respectively, that are customized for the MPI interface.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Examples</h1>
<p>There are a couple of examples for Geant4 MPI applications.</p>
<p>For using ROOT libraries (exMPI02)</p>
<ul>
<li><em>ROOTSYS</em> : root path of the ROOT package</li>
</ul>
<p><a class="el" href="../../d4/d68/exMPI01.html">exMPI01 </a></p>
<p>A simple application.</p>
<p>Configuration:**</p>
<ul>
<li>Geometry : chamber / calorimeter</li>
<li>Primary : particle gun (200 MeV electron as default)</li>
<li><p class="startli">Physics List : FTFP_BERT</p>
<p class="startli">Features:**</p>
</li>
<li><a class="el" href="../../de/d20/classParticles.html">Particles</a> are transported in a geometry without any scoring.</li>
<li>Learn how to parallelized your G4 session.</li>
</ul>
<p><a class="el" href="../../dc/de4/exMPI02.html">exMPI02 (ROOT application) </a></p>
<p>An example of dosimetry in a water phantom. Note: due to limited MT support in ROOT, in this example MT is disabled, but the code is migrated to MT, ready for MT when ROOT will support MT. For an example of MT+MPI take a look at exMPI03</p>
<p>Configuration:**</p><ul>
<li>Geometry : water phantom</li>
<li>Primary : broad beam (200 MeV proton)</li>
<li>Physics List : FTFP_BERT</li>
<li><p class="startli"><a class="el" href="../../d7/dae/classAnalysis.html">Analysis</a> : ROOT histogramming</p>
<p class="startli">Features:**</p>
</li>
<li>Score dose distribution in a water phantom.</li>
<li>Learn how to parallelized your applications.</li>
<li>Create a ROOT file containing histograms/trees in each node.</li>
</ul>
<p><a class="el" href="../../d5/dba/exMPI03.html">exMPI03 (merging of histograms via MPI) </a></p>
<p>This example is the same as exMPI02 with the following differences:</p><ul>
<li>It uses g4tools instead of ROOT for histogramming</li>
<li>It shows how to merge, using g4tools, histograms via MPI so that the entire statistics is accumulated in a single output file</li>
<li>It also shows how to merge <a class="el" href="../../d2/d10/classG4Run.html">G4Run</a> objects from different ranks and how to merge scorers</li>
<li>MT is enabled.</li>
</ul>
<p><a class="el" href="../../d7/d4b/exMPI04.html">exMPI04 (merging of ntuples via MPI) </a></p>
<p>This example is the same as exMPI03 with added ntuple.</p><ul>
<li>It uses g4tools for histogramming and ntuples.</li>
<li>It shows how to merge, using g4tools, ntuples via MPI in sequential mode, so that the entire statistics is accumulated in a single output file.</li>
<li>If MT is enabled, the ntuples are merged from threads to files per ranks.</li>
<li>Combined MT + MPI merging is not yet supported.</li>
<li>Merging ntuples is actually supported only with Root output format. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aExP01Classes_8hh_html_a42045b4b420638c32ed0e076737a5a83"><div class="ttname"><a href="../../d9/d26/ExP01Classes_8hh.html#a42045b4b420638c32ed0e076737a5a83">a</a></div><div class="ttdeci">std::vector&lt; ExP01TrackerHit * &gt; a</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d26/ExP01Classes_8hh_source.html#l00032">ExP01Classes.hh:32</a></div></div>
<div class="ttc" id="achem4_8cc_html_affb5f34f39f7103b999d198b18ffed8e"><div class="ttname"><a href="../../d1/dcb/chem4_8cc.html#affb5f34f39f7103b999d198b18ffed8e">seed</a></div><div class="ttdeci">long seed</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dcb/chem4_8cc_source.html#l00067">chem4.cc:67</a></div></div>
<div class="ttc" id="anamespaceG4ArrayOps_html_ade7cd1394fa7f61c3596efbdcd19c931"><div class="ttname"><a href="../../db/d75/namespaceG4ArrayOps.html#ade7cd1394fa7f61c3596efbdcd19c931">G4ArrayOps::Set</a></div><div class="ttdeci">void Set(G4int Elements, T *To, T Value)</div><div class="ttdoc">Set's all the values in an array to a constant.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddc/G4ArrayOps_8hh_source.html#l00051">G4ArrayOps.hh:51</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
