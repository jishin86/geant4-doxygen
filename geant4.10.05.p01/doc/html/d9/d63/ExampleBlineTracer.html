<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example BlineTracer</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example BlineTracer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Laurent Desorgher (<a href="#" onclick="location.href='mai'+'lto:'+'des'+'or'+'ghe'+'r@'+'phi'+'m.'+'uni'+'be'+'.ch'; return false;">desor<span style="display: none;">.nosp@m.</span>gher<span style="display: none;">.nosp@m.</span>@phim<span style="display: none;">.nosp@m.</span>.uni<span style="display: none;">.nosp@m.</span>be.ch</a>) - 04/10/2003</dd></dl>
<p>The BlineTracer module allows to trace and visualise magnetic field lines in a Geant4 application where particle are tracked through the magnetic field (in future, these functionalities may be integrated in the Geant4 kernel).</p>
<p>To use the tracer, the user should copy the classes provided here in his/her own application/example and create somewhere in his/her code an instance of a <a class="el" href="../../d6/dfa/classG4BlineTracer.html">G4BlineTracer</a> object. It can be anywhere (for example in the main code or in the user class defining the magnetic field):</p>
<pre class="fragment">#include "G4BlineTracer.hh"
G4BlineTracer* theBlineTool = new G4BlineTracer();
</pre><h1><a class="anchor" id="ExampleBlineTracer_s1"></a>
Design principles</h1>
<p>The core of the tool is the method <a class="el" href="../../d6/dfa/classG4BlineTracer.html#a101e07bb8610d82a5fb2b3b0fea44cf7">G4BlineTracer::ComputeBlines()</a> of <a class="el" href="../../d6/dfa/classG4BlineTracer.html">G4BlineTracer</a> class. In this method a bline is computed by tracking a ChargedGeantino in the user defined magnetic field and by using a Bline equation of motion (class <a class="el" href="../../df/dc1/classG4BlineEquation.html">G4BlineEquation</a>, motion along the field) instead of a Lorentz equation. <br  />
</p>
<p>During the execution of this method :</p>
<ul>
<li>The user defined equations of motion associated to the different global and local fields are replaced by instances of <a class="el" href="../../df/dc1/classG4BlineEquation.html">G4BlineEquation</a> associated to the same fields. The <a class="el" href="../../df/dc1/classG4BlineEquation.html">G4BlineEquation</a> class defines the differential equation of a magnetic field line.</li>
<li>User defined ChordFinders are replaced by new ChordFinders associated to the <a class="el" href="../../df/dc1/classG4BlineEquation.html">G4BlineEquation</a> object.</li>
<li>The user primary generator action, run action, event action and stepping action are replaced by instances of the classes <a class="el" href="../../db/d91/classG4BlinePrimaryGeneratorAction.html">G4BlinePrimaryGeneratorAction</a>, <a class="el" href="../../d6/dfa/classG4BlineTracer.html">G4BlineTracer</a>, <a class="el" href="../../de/d39/classG4BlineEventAction.html">G4BlineEventAction</a> and <a class="el" href="../../d2/dd8/classG4BlineSteppingAction.html">G4BlineSteppingAction</a> respectively. Other actions are set to a NULL pointer.</li>
</ul>
<p>After the execution of the method, the original user defined actions, equation of motions and chord-finders are restored. <br  />
</p>
<p>In other words, the deafult run-action is temporarly replaced by a <a class="el" href="../../d6/dfa/classG4BlineTracer.html">G4BlineTracer</a> run-action using the same Geometry, physics and magnetic fields but with a different equation of motion and user actions.</p>
<p>The <a class="el" href="../../db/d91/classG4BlinePrimaryGeneratorAction.html#ad61c1c7e27b409264143e1ce0d5b81f9">G4BlinePrimaryGeneratorAction::GeneratePrimaries()</a> method of the <a class="el" href="../../db/d91/classG4BlinePrimaryGeneratorAction.html">G4BlinePrimaryGeneratorAction</a> class call the GeneratePrimaries() method of the user defined <a class="el" href="../../d7/d27/classPrimaryGeneratorAction.html" title="The primary generator action class with particle gun.">PrimaryGeneratorAction</a> for defining the start position and start time of tracking. Start position for user application and for Bline tracking are therefore controlled by the same UI commands. The type of particles to be tracked when tracing Blines is always set to Charged-Geantino. This allows to switch off the effect of electromagnetic and hadronics physics when tracing field lines.</p>
<p>The <a class="el" href="../../de/d39/classG4BlineEventAction.html">G4BlineEventAction</a> class is responsible to store computed magnetic field lines as a vector of Polylines and Polymarkers for later visualisation. These vectors can be drawn and reset at any time.</p>
<p>The stepping action does nothing in this implementation but it can be used in future versions to limit field line tracing to physical volumes defined by the user. For this purpose a G4BlineStackingAction could also be implemented.</p>
<h1><a class="anchor" id="ExampleBlineTracer_s2"></a>
User Manual</h1>
<h2><a class="anchor" id="ExampleBlineTracer_subs21"></a>
General description</h2>
<p>The BlineTracer is controlled by the UI commands contained in the directory /vis/blineTracer. By calling the command 'computeBline', several magnetic field lines passing through user defined start positions are computed. Start positions are generated by the user primary generator action. By doing so, the definition of start positions is the same for usual particles tracking and magnetic field line tracking.</p>
<p>A magnetic field line is computed as a track of a charged geantino that moves along the field line. The user can define the maximum length of a tracking step (only valid for Bline tracing purposes) by the use of the 'setMaxStepLength' command.</p>
<p>By using small enough maximum step length, smooth magnetic field lines are obtained. By using the command 'stockLines' and 'stockPoints' the user can decide to store the series of tracking step positions defining <br  />
 a magnetic field line as a Polyline object and/or a PolyMarker object (circles) respectively.</p>
<p>These objects are stored in vectors of PolyLines and PolyMarkers. By using the command 'draw', these vectors are added to the scene of the visualisation manager, provided that a scene handler and visualisation driver have been properly created.</p>
<p>The scene is visualised by invoking the vis command '/vis/show'. Polyline objects are visualised as line segments joining the different step positions defining a line, while for a Polymarker object markers (here circles), are drawn at each step positions.</p>
<p>By using the 'setColour' the user defines the visualisation colour that will be associated to the next computed magnetic field lines. By calling 'setPointSize' the user defines the size of visualisation markers that will be associated to the next computed magnetic field lines. The user can remove the vector of Polymarker and Polyline from the memory by invoking 'resetMaterialToBeDrawn'.</p>
<p>When using small max step size and polymarkers for visualisation purposes, the thickness of a smooth magnetic field line is obtained. It is controlled by the Marker size parameter ('setPointSize') <br  />
</p>
<h2><a class="anchor" id="ExampleBlineTracer_subs22"></a>
Command description</h2>
<pre class="fragment">/vis/blineTracer/computeBline  nb_of_lines  
</pre><ul>
<li>Parameters: integer nb_of_lines <br  />
</li>
<li>Description: Compute nb_of_lines different magnetic field lines</li>
</ul>
<pre class="fragment">/vis/blineTracer/setMaxStepLength max_step_length 
</pre><ul>
<li>Parameters: double max_step_length</li>
<li>Description: Set the maximum tracking step length for computing magnetic field lines</li>
</ul>
<pre class="fragment">/vis/blineTracer/setColour  red green blue
</pre><ul>
<li>Parameters: double red, green, blue</li>
<li>Description: Define the colour for visualisation of the next computed magnetic field lines. The color is defined by a RGB code (red,green,blue) with all parameters smaller than 1.</li>
</ul>
<pre class="fragment"> /vis/blineTracer/stockLines aBool
</pre><ul>
<li>Parameters: boolean aBool</li>
<li>Description: If true the next computed field lines are stored as Polylines for further visualisation</li>
</ul>
<pre class="fragment">/vis/blineTracer/stockLines aBool
</pre><ul>
<li>Parameters: boolean aBool</li>
<li>Description: If true the next computed field lines are stored as Polymarkers for further visualisation</li>
</ul>
<pre class="fragment">/vis/blineTracer/setPointSize point_size
</pre><ul>
<li>Parameters: double point_size</li>
<li>Description: set the size of the visualisation markers that will be associated with the next computed magnetic field lines</li>
</ul>
<pre class="fragment">/vis/blineTracer/resetMaterialToBeDrawn
</pre><ul>
<li>Parameters: none</li>
<li>Description: The vector of Polyline and Polymarker representing magnetic field lines to be visualised are removed from memory</li>
</ul>
<pre class="fragment">/tracking/storeTrajectory 1
</pre><ul>
<li>If the storeTrajectory parameter is not set no field lines are stored. <br  />
</li>
</ul>
<h1><a class="anchor" id="ExampleBlineTracer_s3"></a>
Current limitations &amp; known problems</h1>
<p>The tool is working properly only for detectors parts where magnetic field are defined. It is planned in the future to stop the tracking of field lines in regions where no fields are existing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
