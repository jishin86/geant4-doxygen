<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example B3</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example B3 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example simulates schematically a Positron Emitted Tomography system.</p>
<h1><a class="anchor" id="B3_s1"></a>
GEOMETRY DEFINITION</h1>
<p>The support of gamma detection are scintillating crystals. A small number of such crystals are optically grouped in a matrix of crystals. In this example, individual crystals are not described; only the matrix of crystals is and it is still called 'Crystal' hereafter.</p>
<p>Crystals are circularly arranged to form a ring. Few rings make up the full detector (gamma camera). This is done by positionning Crystals in Ring with an appropriate rotation matrix. Several copies of Ring are then placed in the full detector. <br  />
</p>
<p>The head of a patient is schematised as a homogeneous cylinder of brain tissue, placed at the center of full detector.</p>
<p>The Crystal material, Lu2SiO5, is not included in the G4Nist database. Therefore, it is explicitly built in DefineMaterials().</p>
<h1><a class="anchor" id="B3_s2"></a>
PHYSICS LIST</h1>
<p>The physics list contains standard electromagnetic processes and the radioactiveDecay module for GenericIon. It is defined in the <a class="el" href="../../d4/d51/classB3PhysicsList.html" title="Modular physics list.">B3PhysicsList</a> class as a Geant4 modular physics list with registered physics builders provided in Geant4:</p><ul>
<li><a class="el" href="../../d9/d5f/classG4DecayPhysics.html">G4DecayPhysics</a> - defines all particles and their decay processes</li>
<li><a class="el" href="../../db/d82/classG4RadioactiveDecayPhysics.html">G4RadioactiveDecayPhysics</a> - defines radioactiveDecay for GenericIon</li>
<li><a class="el" href="../../d6/da3/classG4EmStandardPhysics.html">G4EmStandardPhysics</a> - defines all EM standard processes</li>
</ul>
<p>This physics list requires data files for:</p><ul>
<li>low energy electromagnetic processes which path is defined via the G4LEDATA envirnoment variable</li>
<li>data files for nuclides properties which path is defined via the G4ENSDFSTATEDATA envirnoment variable</li>
<li>radioactive decay hadronic processes which path is defined via the G4RADIOACTIVEDATA envirnoment variable.</li>
</ul>
<p>See more on installation of the datasets in <a href="http://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides
                                         /InstallationGuide/html/ch03s03.html">Geant4 Installation Guide, Chapter 3.3: Note On Geant4 Datasets </a>.</p>
<h1><a class="anchor" id="B3_s3"></a>
ACTION INITALIZATION</h1>
<p><a class="el" href="../../db/dda/classB3aActionInitialization.html" title="Action initialization class.">B3aActionInitialization</a> class (see also <a class="el" href="../../d5/d51/classB3bActionInitialization.html" title="Action initialization class.">B3bActionInitialization</a>) instantiates and registers to Geant4 kernel all user action classes.</p>
<p>While in sequential mode the action classes are instatiated just once, via invoking the method: <a class="el" href="../../db/dda/classB3aActionInitialization.html#a2651c9f2024e0261939a0443d0491ac9">B3aActionInitialization::Build()</a> (see also <a class="el" href="../../d5/d51/classB3bActionInitialization.html#ac4a68baaacc783a7a65bee89cc43b5c8">B3bActionInitialization::Build</a>) in multi-threading mode the same method is invoked for each thread worker and so all user action classes are defined thread-local.</p>
<p>A run action class is instantiated both thread-local and global that's why its instance is created also in the method <a class="el" href="../../db/dda/classB3aActionInitialization.html#ad09dd517755825f8a0dd4792fc7d9c1b">B3aActionInitialization::BuildForMaster()</a> (see also <a class="el" href="../../d5/d51/classB3bActionInitialization.html#ac4a68baaacc783a7a65bee89cc43b5c8">B3bActionInitialization::Build</a>) which is invoked only in multi-threading mode.</p>
<h1><a class="anchor" id="B3_s4"></a>
PRIMARY GENERATOR</h1>
<p>The default particle beam is an ion (F18), at rest, randomly distributed within a zone inside a patient and is defined in <a class="el" href="../../df/dbe/classB3PrimaryGeneratorAction.html#a111c32ea03fc0fa573022e6ea01c6da0">B3PrimaryGeneratorAction::GeneratePrimaries()</a>. The type of a primary particle can be changed with <a class="el" href="../../dc/ded/classG4ParticleGun.html">G4ParticleGun</a> commands (see run2.mac).</p>
<h1><a class="anchor" id="B3_s5"></a>
DETECTOR RESPONSE : scorers</h1>
<p>A 'good' event is an event in which an identical energy of 511 keV is deposited in two separate Crystals. A count of the number of such events corresponds to a measure of the efficiency of the PET system. The total dose deposited in a patient during a run is also computed.</p>
<p>Scorers are defined in <a class="el" href="../../d5/d55/classB3DetectorConstruction.html#a1e6cf35b820f30dd78638cadfb65c675">B3DetectorConstruction::ConstructSDandField()</a>. There are two <a class="el" href="../../da/d7e/classG4MultiFunctionalDetector.html">G4MultiFunctionalDetector</a> objects: one for the Crystal (EnergyDeposit), and one for the Patient (DoseDeposit)</p>
<p>The scorers hits are saved in form of ntuples in a Root file using Geant4 analysis tools. This feature is activated in the main () function with instantiating <a class="el" href="../../d4/d61/classG4ScoreNtupleWriter.html">G4ScoreNtupleWriter</a>.</p>
<p>Two variants of accumulation event statistics in a run are demonstrated in this example:</p>
<p>B3a:</p>
<p>At the end of event, the values acummulated in <a class="el" href="../../d8/d3d/classB3aEventAction.html" title="Event action class.">B3aEventAction</a> are passed in <a class="el" href="../../d9/dfb/classB3aRunAction.html" title="Run action class.">B3aRunAction</a> and summed over the whole run (see B3aEventAction::EndOfevent()). In multi-threading mode the data accumulated in <a class="el" href="../../d1/d5e/classG4Accumulable.html">G4Accumulable</a> objects per workers is merged to the master in <a class="el" href="../../d9/dfb/classB3aRunAction.html#a0c2c50512ef08f6e26b94bbfeacadb4b">B3aRunAction::EndOfRunAction()</a> and the final result is printed on the screen.</p>
<p>G4Accumulable&lt;&gt; type instead of G4double and G4int types is used for the <a class="el" href="../../d9/dfb/classB3aRunAction.html" title="Run action class.">B3aRunAction</a> data members in order to facilitate merging of the values accumulated on workers to the master. Currently the accumulables have to be registered to G4AccumulablesManager and <a class="el" href="../../d1/d66/namespaceG4mpi.html#a02cde5c47109e1fe26adba5ed2b33cea">G4AccumulablesManager::Merge()</a> has to be called from the users code. This is planned to be further simplified with a closer integration of <a class="el" href="../../d1/d5e/classG4Accumulable.html">G4Accumulable</a> classes in the Geant4 kernel next year.</p>
<p>B3b:</p>
<p><a class="el" href="../../d2/d89/classB3bRun.html#ae129ffca7325a9d8cd123632da88cef6">B3bRun::RecordEvent()</a>, called at end of event, collects informations event per event from the hits collections, and accumulates statistic for <a class="el" href="../../dc/d21/classB3bRunAction.html#af779b6b6f2ae213d39020371c545b567">B3bRunAction::EndOfRunAction()</a>. <br  />
 In addition, results for dose are accumulated in a standard floating-point summation and using a new lightweight statistical class called <a class="el" href="../../da/df3/classG4StatAnalysis.html">G4StatAnalysis</a>. The <a class="el" href="../../da/df3/classG4StatAnalysis.html">G4StatAnalysis</a> class records four values: (1) the sum, (2) sum^2, (3) number of entries, and (4) the number of entries less than mean * machine-epsilon (the machine epsilon is the difference between 1.0 and the next value representable by the floating-point type). From these 4 values, <a class="el" href="../../da/df3/classG4StatAnalysis.html">G4StatAnalysis</a> provides the mean, FOM, relative error, standard deviation, variance, coefficient of variation, efficiency, r2int, and r2eff.</p>
<p>In multi-threading mode the statistics accumulated per workers is merged to the master in <a class="el" href="../../d2/d89/classB3bRun.html#a931ac17cf23f04ec715833cb8763505c">B3bRun::Merge()</a>.</p>
<h1><a class="anchor" id="B3_s6"></a>
STACKING ACTION</h1>
<p>Beta decay of Fluor generates a neutrino. One wishes not to track this neutrino; therefore one kills it immediately, before created particles are put in a stack. The function <a class="el" href="../../d3/d1e/classB3StackingAction.html#a71555ca3e81c03f22219bc81681a60dd">B3StackingAction::ClassifyNewTrack()</a> is invoked by G4 kernel each time a new particle is created.</p>
<hr  />
<p>The following paragraphs are common to all basic examples</p>
<h1><a class="anchor" id="B3_A"></a>
VISUALISATION</h1>
<p>The visualization manager is set via the <a class="el" href="../../df/d51/classG4VisExecutive.html">G4VisExecutive</a> class in the main () function in exampleB3.cc. <br  />
 The initialisation of the drawing is done via a set of /vis/ commands in the macro vis.mac. This macro is automatically read from the main function when the example is used in interactive running mode.</p>
<p>By default, vis.mac opens an OpenGL viewer (/vis/open OGL). The user can change the initial viewer by commenting out this line and instead uncommenting one of the other /vis/open statements, such as HepRepFile or DAWNFILE (which produce files that can be viewed with the HepRApp and DAWN viewers, respectively). Note that one can always open new viewers at any time from the command line. For example, if you already have a view in, say, an OpenGL window with a name "viewer-0", then </p><pre class="fragment">/vis/open DAWNFILE
</pre><p> then to get the same view </p><pre class="fragment">/vis/viewer/copyView viewer-0
</pre><p> or to get the same view <em>plus</em> scene-modifications </p><pre class="fragment">/vis/viewer/set/all viewer-0
</pre><p> then to see the result </p><pre class="fragment">/vis/viewer/flush
</pre><p>The DAWNFILE, HepRepFile drivers are always available (since they require no external libraries), but the OGL driver requires that the Geant4 libraries have been built with the OpenGL option.</p>
<p>For more information on visualization, including information on how to install and run DAWN, OpenGL and HepRApp, see the visualization tutorials, for example,<br  />
</p><ul>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4OpenGLTutorial/G4OpenGLTutorial.html">OpenGL Tutorial </a></li>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4DAWNTutorial/G4DAWNTutorial.html">DAWN Tutorial </a></li>
<li><a href="http://geant4.slac.stanford.edu/Presentations/vis/G4HepRAppTutorial/G4HepRAppTutorial.html">HepRApp Tutorial </a></li>
</ul>
<p>The tracks are automatically drawn at the end of each event, accumulated for all events and erased at the beginning of the next run.</p>
<h1><a class="anchor" id="B3_B"></a>
USER INTERFACES</h1>
<p>The user command interface is set via the <a class="el" href="../../d1/d6d/classG4UIExecutive.html">G4UIExecutive</a> class in the main () function in exampleB3.cc The selection of the user command interface is then done automatically according to the Geant4 configuration or it can be done explicitly via the third argument of the <a class="el" href="../../d1/d6d/classG4UIExecutive.html">G4UIExecutive</a> constructor (see <a class="el" href="../../d7/df4/exampleB4a_8cc.html" title="Main program of the B4a example.">exampleB4a.cc</a>).</p>
<h1><a class="anchor" id="B3_C"></a>
HOW TO RUN</h1>
<ul>
<li>Execute exampleB3a in the 'interactive mode' with visualization <pre class="fragment">% ./exampleB3a
and type in the commands from run1.mac line by line:  
Idle&gt; /control/verbose 2
Idle&gt; /tracking/verbose 2
Idle&gt; /run/beamOn 1 
Idle&gt; ...
Idle&gt; exit
</pre> or <pre class="fragment">Idle&gt; /control/execute run1.mac
....
Idle&gt; exit
</pre></li>
<li>Execute exampleB3a in the 'batch' mode from macro files (without visualization) <pre class="fragment">% ./exampleB3a run2.mac
% ./exampleB3a exampleB3.in &gt; exampleB3.out
</pre> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
