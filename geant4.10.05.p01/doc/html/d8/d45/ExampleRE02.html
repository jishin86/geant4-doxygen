<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example RE02</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example RE02 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example simulates a simplified water phantom measurement in medical application with demonstration of primitive scorers. This example also demonstrates nested parameterised volume which realizes segmented boxes using a combination of replicated volumes and a parameterised volume.</p>
<p>-&mdash; (Tips)</p>
<p>This example creates 100 x 100 x 200 boxes using Nested Parameterised Volume for realistic situation of medical application. This is very memory consumption if normal Parameterised Volume is used, and needs roughly more than 1 GB memory for execution. However, NestedParameterised volume effectively works to reduce the memory consumption, and it only needs less than 100 MB memory for execution.</p>
<h1><a class="anchor" id="RE02_s1-"></a>
GEOMETRY DEFINITION</h1>
<p>The setup contains a water phantom as target by default. The world volume is 200 cm x 200 cm x 200 cm box filled with air. The water phantom is box shape and the size of 200 mm x 200 mm x 400 mm. The volume of water phantom is divided into 100 x 100 x 1 towers using replicated volume,(<a class="el" href="../../dc/d68/classRE02DetectorConstruction.html" title="Uer detector construction class.">RE02DetectorConstruction</a>), and then those towers are segmented into 200 boxes with respect to z axis using nested parameterized volume,(<a class="el" href="../../dc/d61/classRE02NestedPhantomParameterisation.html" title="A nested parameterisation class for a phantom.">RE02NestedPhantomParameterisation</a>). e.g. The volume of water phantom is divided into 100 x 100 x 200 boxes, and a voxel size is 2.0 mm x 2.0 mm x 2.0 mm.</p>
<p>For demonstration purpose of the nested parameterised volume, (<a class="el" href="../../dc/d61/classRE02NestedPhantomParameterisation.html" title="A nested parameterisation class for a phantom.">RE02NestedPhantomParameterisation</a>), materials are assigned as water (lead) in even (odd) order segments, alternately. The simulation for homogeneous water phantom is also possible using an option.</p>
<p>-&mdash; Tips(1)</p>
<p>If you want to reduce number of segments of water phantom, please change following numbers which represent number of segments in x, y, z axis, respectively.The following code can be found in exampleRE02.cc. </p><pre class="fragment">  RE02DetectorConstruction* detector = new RE02DetectorConstruction;
  detector-&gt;SetNumberOfSegmentsInPhantom(100,100,200);
                                          Nx, Ny, Nz
</pre><p> -&mdash; Tips(2)</p>
<p>If you want to set all materials to water, please use the following method. The following code can be found in exampleRE02.cc. </p><pre class="fragment">   detector-&gt;SetLeadSegment(FALSE); // Homogeneous water phantom</pre><p>The geometry and sensitive detector are constructed in <a class="el" href="../../dc/d68/classRE02DetectorConstruction.html" title="Uer detector construction class.">RE02DetectorConstruction</a> class. (See <a class="el" href="../../d8/d45/ExampleRE02.html#RE02_s4">SCORER </a> for detail descriptions about sensitive detector.)</p>
<h1><a class="anchor" id="RE02_s2"></a>
PHYSICS LIST</h1>
<p>The particle's type and the physic processes which is available in this example are set in <a class="el" href="../../d2/daa/classPhysicsList.html">PhysicsList</a> class.</p>
<p>The <a class="el" href="../../d2/daa/classPhysicsList.html">PhysicsList</a> is originally copied from extended example, (example/extended/analysis/A01). Full set of particles (baryons, bosons and mesons) are created, and Standard EM Physics and Low/High Energy parameterized models for hadrons are applied. The detail description will be found in example/extended/analysis/A01/README. Specially, the <a class="el" href="../../d2/daa/classPhysicsList.html">PhysicsList</a> was modified in this example, to use Binary cascade model for hadron physics at low energy (&lt;4GeV) and inelastic process for generic ions with BinaryLightIonReaction. The data files for physics processes have to be assigned using environment variables.</p>
<p>RE02PhysicsList is optimized for robustness and is not optimized for any particular cases. If you will do precise calculation for your use-case, please consider utilizing hadronic_lists, and defines the production cut properly. The default CutValue defines the production threshold of secondary particles (mainly Ionisation and Bremsstrahlung processes are concerned by this CutValue).</p>
<h1><a class="anchor" id="RE02_s3"></a>
RUNS and EVENTS</h1>
<h2><a class="anchor" id="RE02_s31"></a>
Primary particles</h2>
<p>The primary kinematics consists of a single particle which hits the target perpendicular to the input face. The default type of the particle and its energy are set in the <a class="el" href="../../dc/dc7/classRE02PrimaryGeneratorAction.html" title="User primary particle generator class.">RE02PrimaryGeneratorAction</a> class. However it can be changed via the G4 build-in commands of ParticleGun class. The <a class="el" href="../../dc/dc7/classRE02PrimaryGeneratorAction.html" title="User primary particle generator class.">RE02PrimaryGeneratorAction</a> class introduces a beam spot size that makes initial particle position of x,y randomized using a Gaussian random function, where the center position is fixed to (0,0). The standard deviation of the beam spot size is given in <a class="el" href="../../dc/dc7/classRE02PrimaryGeneratorAction.html" title="User primary particle generator class.">RE02PrimaryGeneratorAction</a> as 10 mm.</p>
<h2><a class="anchor" id="RE02_s32"></a>
Event</h2>
<p>An EVENT represents a simulation of one primary particle. A RUN is a set of events.</p>
<p>The user has control:</p><ul>
<li>at Begin and End of each run (class <a class="el" href="../../d7/df6/classRunAction.html" title="Run action class.">RunAction</a>)</li>
<li>at Begin and End of each event (class <a class="el" href="../../da/d3b/classEventAction.html" title="Event action class.">EventAction</a>)</li>
<li>at Begin and End of each track (class <a class="el" href="../../d3/df4/classTrackingAction.html">TrackingAction</a>, not used here)</li>
<li>at End of each step (class <a class="el" href="../../d8/db9/classSteppingAction.html">SteppingAction</a>, not used here)</li>
</ul>
<h1><a class="anchor" id="RE02_s4"></a>
SCORER</h1>
<h2><a class="anchor" id="RE02_s41"></a>
Concrete Scorer</h2>
<p>This example introduces concrete primitive scorer (PS) and filter classes for easy scoring. Those primitive scorers are registered to MultiFunctionalDetector which is a concrete class of sensitive detector(SD). Then the MultiFunctionalDetector is attached to the logical volume of sensitive geometry. A MultiFunctionalDetector, PrimitiveScorers, and SDFilters are created and assigned to the logical volume of water phantom in <a class="el" href="../../dc/d5b/classDetectorConstruction.html" title="Simple detector construction with a box volume placed in a world.">DetectorConstruction</a>.</p>
<p>A primitive scorer can score one kind of physical quantity, and creates one hits collection per event. The quantity is collected in <a class="el" href="../../d7/d42/classG4THitsMap.html">G4THitsMap</a> with the copy number of geometry. Here collection name is given as "MultiFunctionalDetector Name"/"PrimitiveScorer Name". A primitive scorer can have one filter (SDFilter) for selecting hits to be used for the quantity.</p>
<p>Since the geometry is constructed using nested parameterisation, the copy number of geometry is defined as follows, </p><pre class="fragment">  copy number of geometry =  iy*Nx*Ny+ix*Nz+iz,
</pre><p>where Nx,Ny,Nz is total number of segmentation in x, y, and z axis,respectively, and ix,iy,iz is a copy number of the mother volume, the grand mother volume, and this volume, respectively. This conversion is described in GetIndex() method in PrimitiveScorer.</p>
<h2><a class="anchor" id="RE02_s42"></a>
The physical quantities scored in this example are:</h2>
<ul>
<li>Total energy deposit <br  />
<ul>
<li>unit: Energy, collName: totalEDep</li>
</ul>
</li>
<li>Energy deposit by protons <br  />
<ul>
<li>unit: Energy, collName: protonEDep</li>
</ul>
</li>
<li>Number of steps of protons <br  />
<ul>
<li>unit: - , collName: protonNStep <br  />
</li>
</ul>
</li>
<li>Cell Flux of charged tracks which pass through the geometry<br  />
<ul>
<li>unit: Length/Volume, collName: chargedPassCellFlux</li>
</ul>
</li>
<li>Cell Flux of all charged tracks<br  />
 <br  />
<ul>
<li>unit: Length/Volume, collName: chargedCellFlux <br  />
</li>
</ul>
</li>
<li>Flux of charged particle at -Z surface of the BOX geometry, where incident angle at the surface is taken into account.<br  />
<ul>
<li>unit: Surface^(-1), collName: chargedSurfFlux</li>
</ul>
</li>
<li>Surface current of gamma at -Z surface of the BOX geometry. The energy of gammas are from 1. keV to 10. keV. The incident angle is not taken into account.<br  />
<ul>
<li>unit: Surface^(-1), collName: gammaSurfCurr000</li>
</ul>
</li>
<li>Same as previous one, but different energy bin. The energy of gammas are from 10. keV to 100. keV.<br  />
<ul>
<li>unit: Surface^(-1), collName: gammaSurfCurr001</li>
</ul>
</li>
<li>Same as previous one, but different energy bin. The energy of gammas are from 100. keV to 1. MeV. <br  />
<ul>
<li>unit: Surface^(-1), collName: gammaSurfCurr002</li>
</ul>
</li>
<li>Same as previous one, except for energy bin. <br  />
 The energy of gammas are from 1. MeV to 10. MeV. <br  />
<ul>
<li>unit: Surface^(-1), collName: gammaSurfCurr003</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="RE02_s43"></a>
Accumulating quantities during a RUN</h2>
<p><br  />
</p>
<p>A PrimitiveScorer creates one hits collection per event. The physical quantity in the hits collection need to be accumulated into another <a class="el" href="../../d7/d42/classG4THitsMap.html">G4THitsMap</a> object during a RUN, in order to obtain integrated flux or dose in a RUN. The accumulation of quantities are done at <a class="el" href="../../df/d0d/classRE02Run.html" title="User run class.">RE02Run</a> class.</p>
<p><a class="el" href="../../df/d0d/classRE02Run.html" title="User run class.">RE02Run</a> class can automatically generate <a class="el" href="../../d7/d42/classG4THitsMap.html">G4THitsMap</a> objects for a RUN, and accumulate physical quantities of an event into it. The accumulation is done at RE02Run::RecordEvent(G4Event* aEvent).</p>
<h2><a class="anchor" id="RE02_s44"></a>
Generate a Run object, and print results</h2>
<p>The <a class="el" href="../../df/d0d/classRE02Run.html" title="User run class.">RE02Run</a> object is generated at <a class="el" href="../../d9/df0/classRE02RunAction.html#af5ad94d7d05410601a7c8e246c82be8c">RE02RunAction::GenerateRun()</a>. <br  />
 The accumulated physical quantities are printed at the end of RUN ( RE02RunAction::EndOfEvent() ). This example prints only selected physical quantities.</p>
<h1><a class="anchor" id="RE02_s5"></a>
VISUALIZATION</h1>
<p>The Visualization Manager is set in the main () (see <a class="el" href="../../da/d42/RE02_8cc.html" title="Main program of the runAndEvent/RE02 example.">RE02.cc</a>). The initialization of the drawing is done via a set of /vis/ commands in the macro vis.mac. This macro is automatically read from the main when running in interactive mode.</p>
<p>The tracks are automatically drawn at the end of event and erased at the beginning of the next run.</p>
<p>The visualization (with OpenGL driver) assumes two things:</p><ol type="1">
<li>the visualization &amp; interfaces categories have been compiled with the environment variable G4VIS_BUILD_OPENGLX_DRIVER.</li>
<li>exampleRE02.cc has been compiled with G4VIS_USE_OPENGLX. <br  />
</li>
</ol>
<p>(The same with DAWNFILE instead of OPENGLX)</p>
<h1><a class="anchor" id="RE02_s6"></a>
USER INTERFACES</h1>
<p>The default command interface, called <a class="el" href="../../d5/de9/classG4UIterminal.html">G4UIterminal</a>, is done via standard G4cin/G4cout. On Linux and Sun-cc on can use a smarter command interface <a class="el" href="../../de/d50/classG4UItcsh.html">G4UItcsh</a>. It is enough to set the environment variable G4UI_USE_TCSH before compiling exampleRE02.cc</p>
<h1><a class="anchor" id="RE02_s7"></a>
HOW TO START ?</h1>
<ul>
<li>Execute RE02 in 'batch' mode from macro files (without visualization) <pre class="fragment">% exampleRE02   run1.mac
</pre> <br  />
</li>
<li>Execute RE02 in 'interactive mode' with visualization <pre class="fragment">% exampleRE02
....
Idle&gt; type your commands. For instance:
Idle&gt; /run/beamOn 10
....
Idle&gt; /control/execute run2.mac
....
Idle&gt; exit
</pre> <br  />
</li>
<li>Macros are for different primary particles.<ul>
<li>vis.mac : 200 MeV proton with visualization</li>
<li>run1.mac : 150 MeV proton</li>
<li>run2.mac : 195 MeV/u Carbon ion</li>
<li>run3.mac : 30 MeV electron</li>
<li>run4.mac : 60 keV gamma </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
