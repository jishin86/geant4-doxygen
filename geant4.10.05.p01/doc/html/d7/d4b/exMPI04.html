<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geant4: Example : exMPI04</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Geant4
   &#160;<span id="projectnumber">10.05.p01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example : exMPI04 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md40"></a>
Description</h1>
<p>An example of dosimetry in a water phantom. The example is as exMPI03, but adds output in G4analysis ntuple and demonstrates ntuple merging.</p>
<p>In difference from merging other data (<a class="el" href="../../d2/d10/classG4Run.html">G4Run</a>, scorers, hitograms), the ntuple data are not sent to the collecting rank(s) at the end of run but during event processing. That's why (an) extra rank(s) have to be reserved for this purpose. The number of extra workers requested is set in <a class="el" href="../../d3/d24/classG4MPImanager.html">G4MPImanager</a> constructor in <a class="el" href="../../d8/d8f/genwindef_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>. While <a class="el" href="../../d3/d24/classG4MPImanager.html">G4MPImanager</a> can be created with any number of extra workers (&lt; total number), the ntuple merging is at present supported only for one.</p>
<p>The extra worker is connected to the run action class via <a class="el" href="../../d8/d4e/classG4MPIextraWorker.html">G4MPIextraWorker</a> object which is set to <a class="el" href="../../d3/d24/classG4MPImanager.html">G4MPImanager</a> in <a class="el" href="../../d8/d8f/genwindef_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>. The standard calls to G4AnalysisManager (creating ntuple, open, write and close file) trigger creating all necessary analysis tools object for merging ntuple data on flight.</p>
<p>MPI ntuple merging can be activated in sequential mode only; this activation is perfomed by creating the <a class="el" href="../../dc/d0a/classG4MPIntupleMerger.html">G4MPIntupleMerger</a> object in the <a class="el" href="../../d8/df4/classRunActionMaster.html">RunActionMaster</a> constructor. The merger must be created before creating G4AnalysisManager (= the first call to G4AnalysisManager::Instance()) and deleted only at the end of program.</p>
<p>If multithreading mode is enabled, the ntuples are merged from threads to files per ranks. Combined MT + MPI merging is not yet supported. Merging ntuples is actually supported only with Root output format.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
How to build</h1>
<p>Use CMake on Geant4 library installed with CMake build.</p>
<p>This example requires <a class="el" href="../../d1/d66/namespaceG4mpi.html">G4mpi</a> library to be installed (see examples/extended/parallel/MPI/source/REDME.md)</p>
<p>Follow these commands, </p><pre class="fragment">&gt; mkdir build
&gt; cd build
&gt; cmake -DG4mpi_DIR=&lt;where-G4mpi-wasintalled&gt;/lib[64]/G4mpi -DCMAKE_CXX_COMPILER=mpicxx \
  -DGeant4_DIR=&lt;your Geant4 install path&gt;/lib[64]/Geant4-V.m.n &lt;path-to-source&gt;
  (V.m.n is the version of Geant4, eg. Geant4-9.6.0)
&gt; make
&gt; make install
</pre><p>Replace mpicxx with your MPI-compiler wrapper. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
